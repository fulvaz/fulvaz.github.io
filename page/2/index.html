<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="author" content="Fulvaz"><meta name="description" content="我只是个混github连击的"><title>Fulvaz PlayGroud</title><link href="/favicon.png" rel="icon"><link rel="alternate" href="/atom.xml" title="Fulvaz PlayGroud" type="application/atom.xml"><link href="http://fonts.lug.ustc.edu.cn/css?family=Open+Sans:400" rel="stylesheet"><link href="http://fonts.lug.ustc.edu.cn/css?family=Source+Code+Pro:400,600" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/stylesheets/app.css"></head><body><nav class="slide-menu"><div class="container"><div id="slide-introduction"><section id="slide-avator"></section><section id="slide-name"><p>Fulvaz</p></section><section id="slide-introduction-content"><p>半路出家伪文艺码农</p></section><section id="slide-contacts"></section></div><ul><li><a href="/about">About</a></li><li><a href="/archives">Archive</a></li><li><a href="https://github.com/subuta/hexo-jade-sass-barebone">Source</a></li></ul></div></nav><section id="top-head"><div id="top-head-wraper"><a href="/">Fulvaz PlayGroud</a><i id="top-head-menu-button" aria-hidden="true" class="fa fa-bars"></i></div></section><div class="wrapper"><header id="page-header"><div class="header-background-container"><video loop="true" mute="true" autoplay="true" poster="http://7xp7jw.com1.z0.glb.clouddn.com/myTheme/static/images/header-background.jpg" class="header-background-video"><source src="http://7xp7jw.com1.z0.glb.clouddn.com/myTheme/static/videos/Blurry-Lights.webm" type="video/webm"><source src="http://7xp7jw.com1.z0.glb.clouddn.com/myTheme/static/videos/Blurry-Lights.mp4" type="video/mp4"><source src="http://7xp7jw.com1.z0.glb.clouddn.com/myTheme/static/videos/Blurry-Lights.ogv" type="video/ogv"></video></div><div class="header-background-shelter"></div><div id="masthead"><div class="wrapper"><h1 id="site-title">Fulvaz PlayGroud</h1><p id="description">我只是个混github连击的</p></div></div></header><section id="content"><ul class="article-list"><li class="reveal-detect"><article><div class="article-head"><h2 class="article-title"><a href="/2016/06/02/javascript精粹读书笔记/">javascript精粹读书笔记</a></h2><div class="meta article-date">2016-06-02</div></div><!-- abstract--><div class="article-content markdown-body"><!-- build time:Sat Jun 24 2017 17:11:19 GMT+0800 (CST) --><blockquote><p>快速说明: 这本书在今天(2016年06月02日)实在是已经过时了, 我这里记录下可以一看的内容,</p><p>吐槽: 研究原型继承很蠢, ES6已经实现了class, 其用法比其实现更重要. 另外, 函数式编程是另一种更恰当的方案</p><p>吐槽2: 这本书的作者不知道为什么非常热衷于修改自带类型的方法(比如Array)……会踩坑的好吧!</p></blockquote><a id="more"></a><p>级联</p><hr><p>每次操作完都返回同一个对象 (java玩烂了)!</p><p>Curry</p><hr><p>返回一个定制函数, 供后面调用</p><p>Memoize</p><hr><p>Lodash已经完全实现了</p><p>一个类似Dispatcher的监听者模式 Part</p><hr><hr><p>不好可能只是因为过时了吧</p><!-- rebuild by neat --></div></article></li><li class="reveal-detect"><article><div class="article-head"><h2 class="article-title"><a href="/2016/03/02/再见2015-我的进宅脱宅之旅/">再见2015 - 我的进宅脱宅之旅</a></h2><div class="meta article-date">2016-03-02</div></div><!-- abstract--><div class="article-content markdown-body"><!-- build time:Sat Jun 24 2017 17:11:19 GMT+0800 (CST) --><blockquote><p>事先声明: 是标题党</p></blockquote><a id="more"></a><h2 id="题记"><a href="#题记" class="headerlink" title="题记"></a>题记</h2><p>去年从5月开始就一直宅在宿舍了, 起先是因为下雨不想出门, 后来以效率为借口不想出门, 直到我发现我性格出现了变化, 才明白: 宅出事了.</p><p>特别是这篇文章, 让我深深感到后怕<br><code>http://daily.zhihu.com/story/7928517?utm_campaign=in_app_share&amp;utm_medium=iOS&amp;utm_source=weixin&amp;from=timeline&amp;isappinstalled=1</code></p><p>坏消息是, 我明白得有点晚, 好消息是, 我明白了</p><h2 id="上课"><a href="#上课" class="headerlink" title="上课"></a>上课</h2><p>如果总结自己研究生第一学期, 那就是上课, 无穷无尽的课程, 导师的培养方式非常别致, 让我去上课, 上上上上, 起先挺好的, 我感觉进入了一个个新的世界, 只想当码农的程序员不是好工程师. 然而后面事情就不对头了, 诶, 怎么老觉得都是浮在空中的理论, 而无法降落到地面呢? 拓荒!</p><h2 id="野人"><a href="#野人" class="headerlink" title="野人"></a>野人</h2><p>一个词即可概括我的研二上学期生活: 野人. 野到什么程度呢? 老师都快要忘记我了, 非常纳闷地问我, 你怎么不积极了呢? 虽然我也很想回答他怎么回事, 但我还是笑笑糊弄过去了, 宝宝心里苦, 可我就是不说. 但是也算长了见识吧.</p><h3 id="html-css"><a href="#html-css" class="headerlink" title="html/css"></a>html/css</h3><p>所以我在干嘛呢? 前端火了, 到处都在吹, 好! 学html/css, 结果工具倒是会了一堆, guard, live load, emmet, 然而只学会了花架子.</p><h3 id="node"><a href="#node" class="headerlink" title="node"></a>node</h3><p>前端还有js, 回想起暑假被java多线程折磨得死去活来, 那不如试下node! 纯异步, 没多线程, 没内存共享, 只要你喜欢, 用函数式编程都可以! 但是事与愿违, 我并没有学到其/“并发/“的思想, 倒是弄明白了restful api, 顺便还了解了redis和MongoDB. redis是个好东西!</p><h3 id="golang"><a href="#golang" class="headerlink" title="golang"></a>golang</h3><p>后来呢, 饿了么推了个黑客马拉松, 又是一个追求高并发的项目. 很有意思的一个比赛, 让我深深感受到了世界的恶意 ——- 这世上的大牛还是太多了啊. 特别是一项特别特别有趣的技术: 缓存. 后来看了一些文章, 全在千方百计利用业务逻辑规则设置缓存, 使性能最大化. 果然简单的方案反而会最实用.(我当然知道这样会降低代码的可维护性:&gt;). 跑题了, 用golang其实是想学, 就这么简单, 当然现在发现, 这门类c语言用来做web开发貌似不太合适, golang的应用应该要更加底层一些. 这次其实是对我的检验, 我自己还是挺满意的, 用着之前学node和nosql的基础, 硬是把单机测试给过了, 这个也是我第一次独立做的项目. 嗯, 你说结果吗? 因为commit手快, 拿了安慰奖, 至于性能? 真的好难看.</p><h3 id="校正"><a href="#校正" class="headerlink" title="校正"></a>校正</h3><p>老板找了我两次, 都问我东西做得怎么样了. 其实直到现在我都是坚持做不了, 因为我觉得一样已经商业化大规模生产的东西自己重新实现一遍, 然后去申请专利实在是异想天开, 关键做的过程中也越来越发现逻辑上讲不通, 或者是某些步骤太过诡异. 虽然我第一次到老板的方案时感觉好棒.</p><p>anyway, 我还是去实现了一个, 中间跌宕起伏的过程就不说了, 反正就是个很简单的线性回归, 加点归一化等等的小处理, 结果是什么呢? 这么说吧, 每次拍摄都要重新采集一次现场的光照, 不然结果很糟糕, 这和老板的期望相差甚远.</p><p>有一件事情值得一提, 我和老板反馈说我不知道如何进行下去时, 老板说会自己亲自下场帮我看代码改算法. 至于老板最后有没有帮我改进算法这件事是很有想象空间的 : )</p><p>当然我现在貌似有idea去改进, 但是我实在没有欲望去做了, 越做越感到心累.</p><p>收获不是没有, 我倒是把ng的公开课上了, 很有意思, 也和我边学边用获得的成就感有关, 我第一次觉得算法也是这么有趣的, 早点学的话, 当初学线代也许会有趣得多.</p><h2 id="脱宅"><a href="#脱宅" class="headerlink" title="脱宅"></a>脱宅</h2><h3 id="人"><a href="#人" class="headerlink" title="人"></a>人</h3><p>我每次作出改变都会是因为环境或者是人. 这次是人, 好多年都没这种感觉了.</p><p>这个人我就不详细说了, 哪天被她视奸到我的博客怪不好意思的.</p><p>她是我的好朋友, 也很大可能是我这辈子都不会记得的一个人. 她好到什么程度呢? 好到你只想和她发生纯洁的友谊, 小心翼翼地保持着距离, 怕向前踏一步就把她吓走了.</p><p>人本来就是一本书.</p><h3 id="现充"><a href="#现充" class="headerlink" title="现充!"></a>现充!</h3><p>必须做现充啊, 这个世界有意思的事情和人那么多, 我又是何必要蹲在宿舍自讨没趣.</p><h2 id="End"><a href="#End" class="headerlink" title="End"></a>End</h2><p>这段宅的时间并不虚度, 至少我玩技术玩得很开心, 乱七八糟学了一堆, 也算弥补了自己的小心愿: 重新读一次本科, 把想知道的技术全部玩一遍. 有时候去上课, 看着这群本科生在浪费时间真是又可悲又可气, 悲在自己也这么虚度过, 气在:大哥我们换换,我想读本科.</p><p>- 嗯, 反正最后你还是会觉得自己在浪费时间吧?<br>- 你说得很有道理</p><h3 id="文末装逼"><a href="#文末装逼" class="headerlink" title="文末装逼"></a>文末装逼</h3><p>我有说过我已经纯linux很久了吗?</p><p>另外, 我两年前的愿望就要实现了, 换macbook</p><p>EOF</p><!-- rebuild by neat --></div></article></li><li class="reveal-detect"><article><div class="article-head"><h2 class="article-title"><a href="/2015/12/19/Machine-Learning-Week3/">Machine Learning Week3</a></h2><div class="meta article-date">2015-12-19</div></div><!-- abstract--><div class="article-content markdown-body"><!-- build time:Sat Jun 24 2017 17:11:19 GMT+0800 (CST) --><p>我也不知道为啥hexo会无法转换这篇笔记<br>看这吧<br><a href="http://fulvaz.leanote.com/post/Machine-learning" target="_blank" rel="external">http://fulvaz.leanote.com/post/Machine-learning</a></p><!-- rebuild by neat --></div></article></li><li class="reveal-detect"><article><div class="article-head"><h2 class="article-title"><a href="/2015/12/19/Machine-Learning-Week01-02/">Machine Learning | Week01 &amp; 02</a></h2><div class="meta article-date">2015-12-19</div></div><!-- abstract--><div class="article-content markdown-body"><!-- build time:Sat Jun 24 2017 17:11:19 GMT+0800 (CST) --><h1 id="Week-01"><a href="#Week-01" class="headerlink" title="Week 01"></a>Week 01</h1><hr><h1 id="supervisor-learning"><a href="#supervisor-learning" class="headerlink" title="supervisor learning"></a>supervisor learning</h1><p>are given a data set and already know what our correct output should look like<br>unsupervise leanring</p><h2 id="regression-problem"><a href="#regression-problem" class="headerlink" title="regression problem"></a>regression problem</h2><p>predict result with <strong>continuous</strong> output</p><h2 id="classification-problem"><a href="#classification-problem" class="headerlink" title="classification problem"></a>classification problem</h2><p>predict in <strong>discrete</strong> categories</p><h1 id="unsupervisor-learning"><a href="#unsupervisor-learning" class="headerlink" title="unsupervisor learning"></a>unsupervisor learning</h1><p>我们有一堆数据,但是我们自己也不知道会产生什么结果,我们用算法produce结果</p><p>关键: clustering<br>收集相关的数据</p><h1 id="Linear-Regression-with-One-Variable"><a href="#Linear-Regression-with-One-Variable" class="headerlink" title="Linear Regression with One Variable"></a>Linear Regression with One Variable</h1><h2 id="The-Hypothesis-Function"><a href="#The-Hypothesis-Function" class="headerlink" title="The Hypothesis Function"></a>The Hypothesis Function</h2><h2 id="Cost-Function"><a href="#Cost-Function" class="headerlink" title="Cost Function"></a>Cost Function</h2><p>描述hypothesis function准确度的函数<br><img src="https://leanote.com/api/file/getImage?fileId=566e3d76ab64416467000ef9" alt="">(<a href="https://leanote.com/api/file/getImage?fileId=5667cab8ab6441601e0014be" target="_blank" rel="external">https://leanote.com/api/file/getImage?fileId=5667cab8ab6441601e0014be</a>)</p><p>这函数叫<code>&quot;Squared error function&quot;</code>, or <code>Mean squared error</code></p><p>1/2的原因是方便这个函数后面用梯度下降法(computation of the gradient descent), 因为平方的倒数项的导数的常数刚好和1/2约掉(as the derivative term of the square function will cancel out the 12 term.) &lt;- 学英文</p><p>taking the derivative 求导</p><h1 id="Gradient-Descent"><a href="#Gradient-Descent" class="headerlink" title="Gradient Descent"></a>Gradient Descent</h1><p>way to automatically improve our hypothesis function<br>repeat until convergence:<br><img src="https://leanote.com/api/file/getImage?fileId=566e3d76ab64416467000ef8" alt="">(<a href="https://leanote.com/api/file/getImage?fileId=5667cab8ab6441601e0014ba" target="_blank" rel="external">https://leanote.com/api/file/getImage?fileId=5667cab8ab6441601e0014ba</a>)</p><p><code>:=</code> 的意思是assignment, 即编程里面的<code>=</code>, 因为数学不能直接使用<code>=</code></p><p>没有必要修改alpha(learning rate), 取导的时候会,整项会自动变小</p><h1 id="Gradient-Descent-for-Linear-Regression"><a href="#Gradient-Descent-for-Linear-Regression" class="headerlink" title="Gradient Descent for Linear Regression"></a>Gradient Descent for Linear Regression</h1><p>经过一番不为人知的推导,得出来优化过的公式<br><img src="https://leanote.com/api/file/getImage?fileId=566e3d75ab64416467000ef3" alt="">(<a href="https://leanote.com/api/file/getImage?fileId=5667cab8ab6441601e0014c4" target="_blank" rel="external">https://leanote.com/api/file/getImage?fileId=5667cab8ab6441601e0014c4</a>)</p><p><a href="https://eventing.coursera.org/api/redirectStrict/QgxGOfcpet0RTRhoSKJ1ezxyBz8TJelio7I-8zayGbedVqU0SZji70rZzgY-owQoCsgg6gt5y0fNjYbB7_zidg.YokNaWe3vKM8XhRLSFOV3w.OhCCAk2hbbjCOeheHZT-Ec3YODIG0LI8bEMdOFB_X_yR99_Xuew4jF2nlOlWJVyF8KivhfQENCP2_HU2NKHgAw_EjHVO7WZcn-vhXG2Ai61Ge99NadDaU-01Z6JC93LlkFSxP4un70pso_XiE9k4uGIBI2hfXhiObFrwJh5hkD3c5P1RgoPfOKRyXSljc49sAOJ44WTEeRBSnwhuKGUHVs1tHeUU3ac0f9-ksLQMCd6uY4rYHAYFAlwSAXnVgf_s6qTGVMm75DvAhDPhvjroKczVk9hgnZ-DjxXkRahjpS0CMTZLbI0pmfBZ4VKrj7SXGbdYLfpVOOcnFA93YK8ifur1QrxqArZgRKkU9RqtB9HesH18w1814VumDEPz0Iry2xxzodp6OH8bLG5rCkRXzF6N9POexZFjZiCRCvvshldQlHY3juvTwk02OH9BtkbOH6MzeGBMU4ki9thpIG1kVXnP_TwjGwdmGTfmO1gdTOa3imoZU79WZXvL2gSRS84NmPpCBopOH8QScrCLnMqkuA" target="_blank" rel="external">推导过程</a>在这里,但是我没勇气去看</p><h1 id="线性代数复习"><a href="#线性代数复习" class="headerlink" title="线性代数复习"></a>线性代数复习</h1><h2 id="Notation-and-terms"><a href="#Notation-and-terms" class="headerlink" title="Notation and terms:"></a>Notation and terms:</h2><ul><li><p>Aij refers to the element in the ith row and jth column of matrix A.</p></li><li><p>A vector with ‘n’ rows is referred to as an ‘n’-dimensional vector</p></li><li><p>vi refers to the element in the ith row of the vector.</p></li><li><p>In general, all our vectors and matrices will be 1-indexed.</p></li><li><p>Matrices are usually denoted by uppercase names while vectors are lowercase.</p></li><li><p>“Scalar” means that an object is a single value, not a vector or matrix.</p></li><li><p>R refers to the set of scalar real numbers</p></li><li><p>Rn refers to the set of n-dimensional vectors of real numbers</p></li></ul><h2 id="向量与矩阵"><a href="#向量与矩阵" class="headerlink" title="向量与矩阵"></a>向量与矩阵</h2><p>小写表示向量Vector<br>大写表示矩阵matrix</p><h2 id="矩阵与代数"><a href="#矩阵与代数" class="headerlink" title="矩阵与代数"></a>矩阵与代数</h2><p>看图<br><img src="https://leanote.com/api/file/getImage?fileId=566e3d76ab64416467000efb" alt="">(<a href="https://leanote.com/api/file/getImage?fileId=566839fcab6441616d001916" target="_blank" rel="external">https://leanote.com/api/file/getImage?fileId=566839fcab6441616d001916</a>)</p><h2 id="Identity-matrix"><a href="#Identity-matrix" class="headerlink" title="Identity matrix"></a>Identity matrix</h2><p>对角全是1,其他0..中文叫啥来着<br>A<em>I = I</em>A = A</p><p>inverse<br>-<br>A^-1<br>only square matrix has inverse matrix</p><p>A * A^-1 = I</p><h1 id="week02-Multivariate-Linear-Regression"><a href="#week02-Multivariate-Linear-Regression" class="headerlink" title="week02 Multivariate Linear Regression"></a>week02 Multivariate Linear Regression</h1><hr><p>hypothesis: n特征,n个参数</p><h2 id="Gradient-Descent-for-Multiple-Variables"><a href="#Gradient-Descent-for-Multiple-Variables" class="headerlink" title="Gradient Descent for Multiple Variables"></a>Gradient Descent for Multiple Variables</h2><h2 id="Feature-Scaling"><a href="#Feature-Scaling" class="headerlink" title="Feature Scaling"></a>Feature Scaling</h2><p>如果多个特征中,每个特征的样本之间量级差别特别大,其收敛速度会非常慢</p><p>考虑归一化,使converge收敛更快<br><img src="https://leanote.com/api/file/getImage?fileId=566e3d76ab64416467000ef4" alt="">(<a href="https://leanote.com/api/file/getImage?fileId=566839fcab6441616d001912" target="_blank" rel="external">https://leanote.com/api/file/getImage?fileId=566839fcab6441616d001912</a>)</p><p>尽量使x在[-1, 1], 当然是个经验值</p><p>###Mean normalization<br><img src="https://leanote.com/api/file/getImage?fileId=566e3d76ab64416467000ef7" alt="">(<a href="https://leanote.com/api/file/getImage?fileId=566839fcab6441616d001917" target="_blank" rel="external">https://leanote.com/api/file/getImage?fileId=566839fcab6441616d001917</a>)</p><h2 id="Learning-Rate"><a href="#Learning-Rate" class="headerlink" title="Learning Rate"></a>Learning Rate</h2><p>if not work, use smaller alpha</p><ul><li>足够小的alpha,J(theta)会在每次迭代中变小</li><li>太小的alpha会收敛很慢</li></ul><p>###如何找到alpha<br>尝试<br>….0.001, …0.01,… 0.1, ….1</p><h2 id="Features-and-Polynomial-Regression"><a href="#Features-and-Polynomial-Regression" class="headerlink" title="Features and Polynomial Regression"></a>Features and Polynomial Regression</h2><p>选择正确的<strong>model(feature)</strong></p><p>比如房子, w*d(size)一个特征, 比两个w, d要好</p><p>还要<strong>hypothesis的选择</strong><br>比如说房价, x^3…比x^2会好,因为x^2上升到一定程度房价反而下降了,这是不可能的是吧</p><p>要根据实际情况选择</p><p>值得一提的是,如果多项式次数比较多,归一化会非常重要</p><h2 id="Normal-Equation"><a href="#Normal-Equation" class="headerlink" title="Normal Equation"></a>Normal Equation</h2><p>求J方法<br><strong>1.求导</strong><br>但如果theta不是实数就跪在了地上</p><p><strong>2.矩阵求θ</strong><br>$θ=(X^TX)^{-1}X^T$</p><p><img src="https://leanote.com/api/file/getImage?fileId=566e3d76ab64416467000ef6" alt=""></p><p>ps:如果你用normal equation, feature scaling就看可以不加了</p><p><strong>pro&amp;cons:</strong><br><img src="https://leanote.com/api/file/getImage?fileId=566e3d76ab64416467000ef5" alt="">(<a href="https://leanote.com/api/file/getImage?fileId=566942e1ab64413e67000579" target="_blank" rel="external">https://leanote.com/api/file/getImage?fileId=566942e1ab64413e67000579</a>)</p><p>###what if $XX^T$ is non-invertible?<br>原因:</p><ol><li>有冗余数据</li><li>feature太多</li></ol><h2 id="Multivariate-linear-regression"><a href="#Multivariate-linear-regression" class="headerlink" title="Multivariate linear regression"></a>Multivariate linear regression</h2><p>算θ的通用公式<br><img src="https://leanote.com/api/file/getImage?fileId=566e3d76ab64416467000efa" alt="">(<a href="https://leanote.com/api/file/getImage?fileId=566e3d76ab64416467000efc" target="_blank" rel="external">https://leanote.com/api/file/getImage?fileId=566e3d76ab64416467000efc</a>)</p><h1 id="Week02-Octave-tutoria"><a href="#Week02-Octave-tutoria" class="headerlink" title="Week02 Octave tutoria"></a>Week02 Octave tutoria</h1><p>load<br>save a.mat a</p><p>A(3, 2)<br>A(2, :) %取出第二行的内容<br>A(:, 2)<br>A([1 3], :) %取第1,3行内容<br>A = [A, [100; 101; 102]] %右边添加一列<br>A(:) %全部数据放一行<br>C = [A; B] %A下面B<br>C = [A B] %A右边B<br>eye identity matrix</p><h2 id="ComputingData"><a href="#ComputingData" class="headerlink" title="ComputingData"></a>ComputingData</h2><p>A <em>B %矩阵相乘<br>A .</em>B %分别相乘 <code>.</code>是元素级别的操作<br>abs(A)<br>v+ ones(length(v), 1)<br>A<code>%tanspose (A</code>)` %tanspose and transpose<br>max(a)<br>a &lt; 3<br>find(a &lt; 3)<br>A = magic(3) %generate a 3*3 which have the same resule<br>sum(a) %将a全部元素加起来<br>prod<br>floor<br>ceil<br>sum(A, 1) ssu up eacch col<br>sum(A, 2) sum up each row<br>pinv %inverse a matrix</p><h2 id="ploting-data"><a href="#ploting-data" class="headerlink" title="ploting data"></a>ploting data</h2><p>plot<br>hold on %plot in the same window<br>xlabel<br>ylabel<br>legend<br>title<br>print -dpng \’ex.png\’<br>figure(1); plot %plot in different window<br>subplot(1, 2, 1) %create 1*2 grid and focus on the first elememt, use subplot again to draw the following plot<br>axis([0.5 1 -1 1])<br>imageesc(A) % eh….<br>colorbar<br>colormap gray</p><h2 id="Control-statement"><a href="#Control-statement" class="headerlink" title="Control statement"></a>Control statement</h2><figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">%<span class="keyword">for</span> <span class="keyword">loop</span></div><div class="line"><span class="keyword">for</span> i=<span class="number">1</span>:<span class="number">10</span>, </div><div class="line">    </div><div class="line"><span class="keyword">end</span>;</div></pre></td></tr></table></figure><p>while<br></p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span> <span class="built_in">i</span> ＜＝５</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure><p></p><p>disp % == print!</p><p>###define your own function<br>cd to the path of source code<br></p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">% source.m</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="params">[y1, y2]</span> = <span class="title">name</span><span class="params">(params)</span></span></div><div class="line">y1 = x^<span class="number">2</span></div><div class="line">y2 = x^<span class="number">3</span></div></pre></td></tr></table></figure><p></p><h2 id="Vectorization"><a href="#Vectorization" class="headerlink" title="Vectorization"></a>Vectorization</h2><p>矩阵运算比for loop快得多,而且代码量少很多 (代码少,bug也就少</p><p>###example<br><img src="https://leanote.com/api/file/getImage?fileId=5670404fab64416467001cdd" alt="">(<a href="https://leanote.com/api/file/getImage?fileId=5670404fab64416467001cdf" target="_blank" rel="external">https://leanote.com/api/file/getImage?fileId=5670404fab64416467001cdf</a>)</p><p>###gredient descent<br><img src="https://leanote.com/api/file/getImage?fileId=5670404fab64416467001cde" alt="">(<a href="https://leanote.com/api/file/getImage?fileId=5670404fab64416467001cdc" target="_blank" rel="external">https://leanote.com/api/file/getImage?fileId=5670404fab64416467001cdc</a>)<br>其实就是将求导运算转换成了矩阵运算</p><!-- rebuild by neat --></div></article></li><li class="reveal-detect"><article><div class="article-head"><h2 class="article-title"><a href="/2015/12/17/硬盘被误操作格了之后/">硬盘被误操作格了之后</a></h2><div class="meta article-date">2015-12-17</div></div><!-- abstract--><div class="article-content markdown-body"><!-- build time:Sat Jun 24 2017 17:11:19 GMT+0800 (CST) --><h1 id="硬盘被格了"><a href="#硬盘被格了" class="headerlink" title="硬盘被格了"></a>硬盘被格了</h1><p>对的,在重装ubuntu时,我按了一个叫『LVM blabla』的选项,等我进入分区选择时,我意识到了问题不对: 我的分区呢?</p><p>不死心的我直接重启电脑，嗯，忽然想起自己u盘和电脑不兼容，刚才用的是硬盘引导，这下问题大条了。</p><h1 id="这次丢了啥？"><a href="#这次丢了啥？" class="headerlink" title="这次丢了啥？"></a>这次丢了啥？</h1><h2 id="代码！"><a href="#代码！" class="headerlink" title="代码！"></a>代码！</h2><p>对，丢了不少代码，不过不知道值得庆幸还是悲哀，作为一个菜鸡，写过的代码全是demo，虽然都是js和golang的代码……嗯……还能接受。最关键的是这几天的工作，装逼如我，提交到github上了，（我觉得今年最明智的选择就是学习了git）clone回来就行，啥事都没有，那堆远古代码也在网盘有备份。那就是我损失了一堆新学习的demo。</p><p>##blog！<br>对，就是我这个blog，本地hexo文件被清了。好消息是我习惯先在leanote上写好文章，然后再发布到github page，那就是说，去leanote上能找回文章备份。<br>比较烦心的就是我要重新搭建hexo，装nodejs，装cnpm，配置，装deploy插件，换主题，小修改………文章量比较小，很快就恢复了。</p><p>当然为了以防万一，我还是在github建了个私有仓库备份了blog的源码。</p><h2 id="论文！"><a href="#论文！" class="headerlink" title="论文！"></a>论文！</h2><p>嘿嘿，老夫用mendeley，云同步，加上我研究问题喜欢记log，重新下也可以。</p><h1 id="真没丢啥东西吗？"><a href="#真没丢啥东西吗？" class="headerlink" title="真没丢啥东西吗？"></a>真没丢啥东西吗？</h1><p>有个定理，如果超过30天没使用过一个内容，那么以后再次使用地概率也不大。</p><p>如果这个定理成立的话，那么我除了那堆不值钱的demo，我没丢任何东西。</p><p>强行说丢了啥的话，这次重装花费地时间特别长，我失去了一个稳定可靠，配置完善的win10，还要花一堆时间去重新配置和同步一堆内容，但是和格盘的损失比起来，这点损失简直九牛一毛。</p><h1 id="强行总结"><a href="#强行总结" class="headerlink" title="强行总结"></a>强行总结</h1><p>虽然我想说我处于一个美好的云时代，但是去年我已经赞美过了，就不要再说了。强行总结的话，我想说，云资源这么丰富，不去好好使用简直天理不容，我要去学机器学习。</p><p>我的天，本科的时候我本来有机会见证云的发展，可惜了。</p><!-- rebuild by neat --></div></article></li><li class="reveal-detect"><article><div class="article-head"><h2 class="article-title"><a href="/2015/12/16/基于ubuntu-anyconnect服务器搭建/">基于ubuntu anyconnect服务器搭建</a></h2><div class="meta article-date">2015-12-16</div></div><!-- abstract--><div class="article-content markdown-body"><!-- build time:Sat Jun 24 2017 17:11:19 GMT+0800 (CST) --><h1 id="零点零-快速阅读"><a href="#零点零-快速阅读" class="headerlink" title="零点零 快速阅读"></a>零点零 快速阅读</h1><p>本文和其他方案最大的不同是加入TUN和cert-user-oid,如果你用其他方法错误,可以看看本文,本文旨在不越狱在ios下科学上网</p><h1 id="零-可用方案"><a href="#零-可用方案" class="headerlink" title="零 可用方案"></a>零 可用方案</h1><h2 id="shadowsocks"><a href="#shadowsocks" class="headerlink" title="shadowsocks"></a>shadowsocks</h2><p>首先就排除了这个方案,因为客户端在ios9不能用</p><h2 id="pac代理"><a href="#pac代理" class="headerlink" title="pac代理"></a>pac代理</h2><p>可以利用25端口进行http代理,问题是速度慢100~200k,安全性太差(有来源,但是找不到了)</p><h2 id="Ikev2"><a href="#Ikev2" class="headerlink" title="Ikev2"></a>Ikev2</h2><p>一切都是美好的,直到我发现需要用mac来生成配置文件</p><h2 id="利用ocserv部署anyconnect"><a href="#利用ocserv部署anyconnect" class="headerlink" title="利用ocserv部署anyconnect"></a>利用ocserv部署anyconnect</h2><p>没问题,部分知名服务商都提供了anyconnect服务</p><blockquote><p>以下内容绝大部分来自<a href="http://fewspider.github.io/2015/08/16/ubuntu-ocserv-deploy.html" target="_blank" rel="external">http://fewspider.github.io/2015/08/16/ubuntu-ocserv-deploy.html</a> 我修正了部分问题,并且使用了最新的版本(2015年12月10日)</p></blockquote><h1 id="一-环境"><a href="#一-环境" class="headerlink" title="一 环境"></a>一 环境</h1><ul><li>ubuntu 14.04</li><li>hostwithlinux openvz vps (现在被收购到hostus)</li></ul><blockquote><p>注意: 这篇文章不是小白教程,假设你有一定linux基础</p></blockquote><h1 id="二-必要条件"><a href="#二-必要条件" class="headerlink" title="二 必要条件"></a>二 必要条件</h1><h2 id="TUN支持"><a href="#TUN支持" class="headerlink" title="TUN支持"></a>TUN支持</h2><p>一般可以在vps面板中打开,详细咨询服务商<br>命令</p><blockquote><p>cat /dev/net/tun</p></blockquote><p>可以查询vps当前是否打开了TUN<br>如果显示</p><blockquote><p>cat: /dev/net/tun: File descriptor in bad state</p></blockquote><p>表示支持TUN,满足需求</p><h1 id="三-搭建"><a href="#三-搭建" class="headerlink" title="三 搭建"></a>三 搭建</h1><h2 id="1-下载-amp-解压"><a href="#1-下载-amp-解压" class="headerlink" title="1 下载&amp;解压"></a>1 下载&amp;解压</h2><p><code>wget ftp://ftp.infradead.org/pub/ocserv/ocserv-0.10.10.tar.xz</code><br><code>tar -xf ocserv-0.10.7.tar.xz</code></p><h2 id="2-安装依赖"><a href="#2-安装依赖" class="headerlink" title="2 安装依赖"></a>2 安装依赖</h2><p><code>apt-get install build-essential pkg-config libgnutls28-dev libwrap0-dev libpam0g-dev libseccomp-dev libreadline-dev libnl-route-3-dev</code></p><h2 id="3-编译-amp-安装"><a href="#3-编译-amp-安装" class="headerlink" title="3 编译&amp;安装"></a>3 编译&amp;安装</h2><p><code>cd ocserv-0.10.10/</code><br><code>./configure</code><br><code>make</code><br><code>make install</code></p><h2 id="4-创建密钥"><a href="#4-创建密钥" class="headerlink" title="4 创建密钥"></a>4 创建密钥</h2><p><code>mkdir /etc/ocserv</code><br><code>cd /etc/ocserv</code></p><blockquote><p>这里我将密钥存放到这, 只要你喜欢你可以将密钥存放到任意地方,只要在配置中指定密钥的位置</p></blockquote><p><strong>创建 ca.tmpl</strong></p><blockquote><p>cn = “anyword”<br>organization = “anyword”<br>serial = 1<br>expiration_days = 3650<br>ca<br>signing_key<br>cert_signing_key<br>crl_signing_key</p></blockquote><p><strong>生成 ca 秘钥与证书</strong></p><p><code>certtool --generate-privkey --outfile ca-key.pem</code><br><code>certtool --generate-self-signed --load-privkey ca-key.pem --template ca.tmpl --outfile ca-cert.pem</code></p><p><strong>创建 server.tmpl</strong></p><blockquote><p>cn = “ip” #这里修改为你的vps ip或者域名<br>organization = “anyword”<br>serial = 2<br>expiration_days = 3650<br>signing_key<br>encryption_key<br>tls_www_server</p></blockquote><p>注意: 一旦这里设定为你的ip或者域名,以后就只能使用域名或者ip登陆</p><p><strong>生成 server 秘钥与证书</strong><br><code>certtool --generate-privkey --outfile server-key.pem</code><br><code>certtool --generate-certificate --load-privkey server-key.pem --load-ca-certificate ca-cert.pem --load-ca-privkey ca-key.pem --template server.tmpl --outfile server-cert.pem</code></p><p><strong>生成客户端user.tmpl</strong></p><blockquote><p>cn = “fulvaz”<br>unit = “fulvaz”<br>expiration_days = 365<br>signing_key<br>tls_www_client</p></blockquote><p><strong>生成 user 秘钥与证书</strong><br><code>certtool --generate-privkey --outfile user-key.pem</code><br><code>certtool --generate-certificate --load-privkey user-key.pem --load-ca-certificate ca-cert.pem --load-ca-privkey ca-key.pem --template user.tmpl --outfile user-cert.pem</code></p><p><strong>将证书转换为 PKCS12</strong><br>会提示输入两次密码，随便输，一样就可以咯。待会iOS客户端导入证书的时候，会提示输入密码，这个密码就是现在要输的密码。<br><code>openssl pkcs12 -export -inkey user-key.pem -in user-cert.pem -certfile ca-cert.pem -out user.p12</code></p><h2 id="5-修改配置文件"><a href="#5-修改配置文件" class="headerlink" title="5 修改配置文件"></a>5 修改配置文件</h2><p>###拷贝默认配置文件<br>cp ~/ocserv-0.10.10/doc/sample.config /etc/ocserv/ocserv.conf<br>证书配置相关说明</p><p>###修改ocserv.conf<br>auth改为证书认证的方式，除了<br><code>auth = &quot;certificate&quot;</code><br>注释掉其他 auth =开头的</p><p>###配置 server 秘钥与证书</p><blockquote><p>server-cert = /etc/ocserv/server-cert.pem #注意设置为你key的位置<br>server-key = /etc/ocserv/server-key.pem</p></blockquote><p>###配置 ca 证书</p><blockquote><p>ca-cert = /etc/ocserv/ca-cert.pem</p></blockquote><p>###配置端口号</p><blockquote><p>tcp-port = 2333<br>udp-port = 2333</p></blockquote><p>###修改dns</p><blockquote><p>dns = 8.8.8.8<br>dns = 8.8.4.4</p></blockquote><p>###确保以下两个都是 true</p><blockquote><p>try-mtu-discovery = true<br>cisco-client-compat = true</p></blockquote><p>###修改route<br>全部注释掉,因为我们可以在客户端添加规则 (就是控制那些走vpn,哪些流量走国内)</p><p>###no route<br>保持默认配置</p><p>###修改cert-user-oid<br>修改为<code>cert-user-oid = 2.5.4.3</code><br>貌似使用证书认证这部必须改,原文就没指出</p><h2 id="6-修改-etc-sysctl-conf"><a href="#6-修改-etc-sysctl-conf" class="headerlink" title="6 修改/etc/sysctl.conf"></a>6 修改/etc/sysctl.conf</h2><p>注释掉<br><code>net.ipv4.ip_forward=1</code><br>运行以重新加载<br><code>sysctl -p /etc/sysctl.conf</code></p><h2 id="7-打开-TCP-和-UDP-端口"><a href="#7-打开-TCP-和-UDP-端口" class="headerlink" title="7 打开 TCP 和 UDP 端口"></a>7 打开 TCP 和 UDP 端口</h2><p>比如刚才的端口是2333，那么现在也要是2333</p><blockquote><p>iptables -t filter -A INPUT -p tcp -m tcp –dport 2333 -j ACCEPT<br>iptables -t filter -A INPUT -p udp -m udp –dport 2333 -j ACCEPT<br>iptables -t nat -A POSTROUTING -j MASQUERADE</p></blockquote><h2 id="8-测试搭建"><a href="#8-测试搭建" class="headerlink" title="8 测试搭建"></a>8 测试搭建</h2><p>ocserv -f -d 1</p><p>如果说端口已被占用,可以使用以下命令<br>比如查看2333端口<br><code>lsof -i:2333</code></p><p>干掉占用端口的进程，假设刚才占用2333端口的pid是12345<br><code>kill 9 12345</code></p><h2 id="9-iOS客户端配置"><a href="#9-iOS客户端配置" class="headerlink" title="9 iOS客户端配置"></a>9 iOS客户端配置</h2><p>###安装Cisco AnyConnect</p><p>自行在appstore中安装</p><p>###导入证书</p><p>1.下载证书<br>如果你使用windows,直接使用winscp将user.p12下载回来即可</p><p>如果你使用linux<br><code>scp username@hostname:/pathToFile/user.p12 ~/user.p12</code></p><ol><li>将证书以邮件的方法发送到手机上,然后打开就可以了<br>(或者你可以搭建一个web服务器,通过浏览器访问这个证书,原文就是这个方法)</li></ol><p>###添加连接</p><ol><li>连接 &gt; 添加VPN连接</li></ol><ul><li>说明，随便填</li></ul><ol><li>服务器地址，假设你的VPS的ip 是 111.111.111.111，端口是 2333，那么就是 111.111.111.111:2333，这边就不需要前面加<a href="http://了。" target="_blank" rel="external">http://了。</a></li><li><p>高级 &gt; 证书，选择你刚才导入的那个证书</p></li><li><p>高级 &gt; 按需连接，打开，出现 域列表，永不连接 那边可以添加一下常用的国内站点</p></li><li><p>设置 &gt; 阻止不信任的服务器，这个关掉，不然使用自己颁发的证书会有问题</p></li><li><p>设置 &gt; VPN FIPS模式，这个打开，貌似会比较稳定，心里作用吧(¬_¬)</p></li></ol><h2 id="10-保存iptables"><a href="#10-保存iptables" class="headerlink" title="10 保存iptables"></a>10 保存iptables</h2><p>如果你测试没问题,就使用<br><code>/sbin/iptables-save</code><br>来保存iptables的更改</p><h1 id="四-自启动"><a href="#四-自启动" class="headerlink" title="四 自启动"></a>四 自启动</h1><p>自启动脚本:<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"><span class="comment">### BEGIN INIT INFO</span></div><div class="line"><span class="comment"># Provides:          ocserv</span></div><div class="line"><span class="comment"># Required-Start:    $remote_fs $syslog</span></div><div class="line"><span class="comment"># Required-Stop:     $remote_fs $syslog</span></div><div class="line"><span class="comment"># Default-Start:     2 3 4 5</span></div><div class="line"><span class="comment"># Default-Stop:      0 1 6</span></div><div class="line"><span class="comment">### END INIT INFO</span></div><div class="line"><span class="comment"># Copyright Rene Mayrhofer, Gibraltar, 1999</span></div><div class="line"><span class="comment"># This script is distibuted under the GPL</span></div><div class="line"> </div><div class="line">PATH=/bin:/usr/bin:/sbin:/usr/sbin</div><div class="line">DAEMON=/bin/ocserv</div><div class="line">PIDFILE=/var/run/ocserv.pid</div><div class="line">DAEMON_ARGS=<span class="string">"-c /etc/ocserv/ocserv.conf"</span></div><div class="line"> </div><div class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></div><div class="line">start)</div><div class="line"><span class="keyword">if</span> [ ! -r <span class="variable">$PIDFILE</span> ]; <span class="keyword">then</span></div><div class="line"><span class="built_in">echo</span> -n <span class="string">"Starting OpenConnect VPN Server Daemon: "</span></div><div class="line">start-stop-daemon --start --quiet --pidfile <span class="variable">$PIDFILE</span> --<span class="built_in">exec</span> <span class="variable">$DAEMON</span> -- \</div><div class="line"><span class="variable">$DAEMON_ARGS</span> &gt; /dev/null</div><div class="line"><span class="built_in">echo</span> <span class="string">"ocserv."</span></div><div class="line"><span class="keyword">else</span></div><div class="line"><span class="built_in">echo</span> -n <span class="string">"OpenConnect VPN Server is already running.\n\r"</span></div><div class="line"><span class="built_in">exit</span> 0</div><div class="line"><span class="keyword">fi</span></div><div class="line">;;</div><div class="line">stop)</div><div class="line"><span class="built_in">echo</span> -n <span class="string">"Stopping OpenConnect VPN Server Daemon: "</span></div><div class="line">start-stop-daemon --stop --quiet --pidfile <span class="variable">$PIDFILE</span> --<span class="built_in">exec</span> <span class="variable">$DAEMON</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"ocserv."</span></div><div class="line">rm -f <span class="variable">$PIDFILE</span></div><div class="line">;;</div><div class="line">force-reload|restart)</div><div class="line"><span class="built_in">echo</span> <span class="string">"Restarting OpenConnect VPN Server: "</span></div><div class="line"><span class="variable">$0</span> stop</div><div class="line">sleep 1</div><div class="line"><span class="variable">$0</span> start</div><div class="line">;;</div><div class="line">status)</div><div class="line"><span class="keyword">if</span> [ ! -r <span class="variable">$PIDFILE</span> ]; <span class="keyword">then</span></div><div class="line"><span class="comment"># no pid file, process doesn't seem to be running correctly</span></div><div class="line"><span class="built_in">exit</span> 3</div><div class="line"><span class="keyword">fi</span></div><div class="line">PID=`cat <span class="variable">$PIDFILE</span> | sed <span class="string">'s/ //g'</span>`</div><div class="line">EXE=/proc/<span class="variable">$PID</span>/exe</div><div class="line"><span class="keyword">if</span> [ -x <span class="string">"<span class="variable">$EXE</span>"</span> ] &amp;&amp;</div><div class="line">[ <span class="string">"`ls -l \"<span class="variable">$EXE</span>\" | cut -d'&gt;' -f2,2 | cut -d' ' -f2,2`"</span> = \</div><div class="line"><span class="string">"<span class="variable">$DAEMON</span>"</span> ]; <span class="keyword">then</span></div><div class="line"><span class="comment"># ok, process seems to be running</span></div><div class="line"><span class="built_in">exit</span> 0</div><div class="line"><span class="keyword">elif</span> [ -r <span class="variable">$PIDFILE</span> ]; <span class="keyword">then</span></div><div class="line"><span class="comment"># process not running, but pidfile exists</span></div><div class="line"><span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">else</span></div><div class="line"><span class="comment"># no lock file to check for, so simply return the stopped status</span></div><div class="line"><span class="built_in">exit</span> 3</div><div class="line"><span class="keyword">fi</span></div><div class="line">;;</div><div class="line">*)</div><div class="line"><span class="built_in">echo</span> <span class="string">"Usage: /etc/init.d/ocserv &#123;start|stop|restart|force-reload|status&#125;"</span></div><div class="line"><span class="built_in">exit</span> 1</div><div class="line">;;</div><div class="line"><span class="keyword">esac</span></div><div class="line"> </div><div class="line"><span class="built_in">exit</span> 0</div></pre></td></tr></table></figure><p></p><blockquote><p>来自<a href="https://gist.github.com/kevinzhow/9661623" target="_blank" rel="external">https://gist.github.com/kevinzhow/9661623</a></p></blockquote><p><strong>我做了点小修改</strong><br>将 13 行修改为<br><code>DAEMON=/usr/local/sbin/ocserv</code></p><p>将这个文件保存为<code>/etc/init.d/ocserv</code></p><p>然后运行以下命令</p><blockquote><p>chmod 755 ocserv<br>chmod 755 ocserv<br>update-rc.d ocserv default</p></blockquote><p>然后你就能用以下命令运行了<br><code>Usage: /etc/init.d/ocserv {start|stop|restart|force-reload|status}</code></p><!-- rebuild by neat --></div></article></li><li class="reveal-detect"><article><div class="article-head"><h2 class="article-title"><a href="/2015/12/16/七周七并发模型-笔记/">&lt;七周七并发模型&gt;笔记</a></h2><div class="meta article-date">2015-12-16</div></div><!-- abstract--><div class="article-content markdown-body"><!-- build time:Sat Jun 24 2017 17:11:19 GMT+0800 (CST) --><h1 id="chp2"><a href="#chp2" class="headerlink" title="chp2"></a>chp2</h1><h2 id="共享变量解决冲突"><a href="#共享变量解决冲突" class="headerlink" title="共享变量解决冲突"></a>共享变量解决冲突</h2><p><strong>加锁</strong></p><p><strong>多个共享资源</strong><br>加多个锁,但加多个锁必然可能导致死锁</p><p><strong>死锁</strong><br>保证上锁顺序</p><p><strong>外星方法</strong><br>即调用者不知道其实现的方法</p><p>问题:如果调用者已经加锁,再调用外星方法,这个方法如果有锁,就很有可能死锁,解决方法是调用方法前对调用者进行一次保护性复制(对象),然后在进行调用</p><h2 id="解决死锁"><a href="#解决死锁" class="headerlink" title="解决死锁"></a>解决死锁</h2><p><strong>使用ReentrantLock</strong><br>锁有超时事件,超时会放弃所拥有的锁</p><p>但是这样并不能完全解决死锁问题,这种方案会产生活锁现象,当所有死锁同时超时,那么下次再获得锁时,很有可能会继续死锁</p><p>通过设置不同的超时事件可以减少活锁的概念</p><p>###交替锁</p><p>###条件锁</p><p>###原子变量<br>atomic包</p><p>###自学内容</p><p>###公平锁与非公平锁<br>公平锁: 线程按照先来后到的方式获取锁<br>非公平: 线程竞争,没获取到锁的线程会被压进队列,但是,压进队列的线程依旧会被后到的线程抢到锁</p><p>公平锁和非公平锁的区别是性能,非公平锁的性能回事公平锁的5~10倍<br>(数据来源: <a href="http://www.majin163.com/2014/03/17/synchronized2/" target="_blank" rel="external">http://www.majin163.com/2014/03/17/synchronized2/</a>)</p><p>###虚假唤醒(spurious wakeup)<br>就算没人调用signal,await还是有可能会被调用</p><p>所以用while等待条件满足唤醒,就算被虚假唤醒了,因为要判断一次条件,所以也能避免虚假唤醒造成的问题</p><p>###为什么synchronize比reentrantlock慢<br>因为syn是悲观锁,reentrantlock是乐观锁</p><blockquote><p>独占锁意味着其他线程只能依靠阻塞来等待线程释放锁。而在CPU转换线程阻塞时会引起线程上下文切换，当有很多线程竞争锁的时候，会引起CPU频繁的上下文切换导致效率很低<br><a href="http://blog.csdn.net/natian306/article/details/18504111" target="_blank" rel="external">http://blog.csdn.net/natian306/article/details/18504111</a></p></blockquote><h1 id="最佳方案"><a href="#最佳方案" class="headerlink" title="最佳方案"></a>最佳方案</h1><h2 id="使用线程池"><a href="#使用线程池" class="headerlink" title="使用线程池"></a>使用线程池</h2><p>实际使用中极少会直接创建线程</p><p>线程池大小?</p><!-- rebuild by neat --></div></article></li><li class="reveal-detect"><article><div class="article-head"><h2 class="article-title"><a href="/2015/12/16/Golang内存模型-嚼过的笔记/">&lt;Golang内存模型&gt; 嚼过的笔记</a></h2><div class="meta article-date">2015-12-16</div></div><!-- abstract--><div class="article-content markdown-body"><!-- build time:Sat Jun 24 2017 17:11:19 GMT+0800 (CST) --><h1 id="Happens-Before"><a href="#Happens-Before" class="headerlink" title="Happens Before"></a>Happens Before</h1><p>操作内存的局部顺序</p><p>如果r可以读取到v被w修改,那么需要满足两个条件</p><ol><li>r不能在w之前进行</li><li>没有其他w`在w后,r前,修改了v</li></ol><p>为了保证r对特定w的观察,要保证r只能观察w,即</p><ol><li>w在r前发生</li><li>其他w`要么在w前发生,要么在r后发生</li></ol><p>后一条件更强</p><p>ps1: 对v初始化也是个w<br>ps2: 读写超过a single machine word的值,读写顺序是乱序的</p><h1 id="Synchronization"><a href="#Synchronization" class="headerlink" title="Synchronization"></a>Synchronization</h1><h2 id="Initialization"><a href="#Initialization" class="headerlink" title="Initialization"></a>Initialization</h2><p>init()在包的全部函数前执行</p><p>所有的init()都在main.main前执行</p><h2 id="Goroutine-creation"><a href="#Goroutine-creation" class="headerlink" title="Goroutine creation"></a>Goroutine creation</h2><h2 id="Goroutine-destruction"><a href="#Goroutine-destruction" class="headerlink" title="Goroutine destruction"></a>Goroutine destruction</h2><p>goroutine的结束并不能保证happen before任意操作</p><p>…老感觉是废话,反正我就不会这么写</p><h2 id="Channel-communication"><a href="#Channel-communication" class="headerlink" title="Channel communication"></a>Channel communication</h2><p><strong>unbuffer channel</strong><br>如果没接收goroutin没接收,发送goroutin会block,直到接收成功为止</p><p><strong>buffer channel</strong><br>The kth receive on a channel with capacity C happens before the k+Cth send from that channel completes.</p><p>通过buffer channel控制同时并发的数量,buffer的容量是最大并发书,buffer内item的数量是active的线程数</p><p>例子:<br>下面例子展示了如何用buffer channel控制线程数量<br></p><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> limit = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">3</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	<span class="keyword">for</span> _, w := <span class="keyword">range</span> work &#123;</div><div class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(w <span class="keyword">func</span>()</span>)</span> &#123;</div><div class="line">			limit &lt;- <span class="number">1</span></div><div class="line">			w()</div><div class="line">			&lt;-limit</div><div class="line">		&#125;(w)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">select</span>&#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><h2 id="Locks"><a href="#Locks" class="headerlink" title="Locks"></a>Locks</h2><p>sync.Mutex<br>sync.RWMutex</p><p>例子:<br></p><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> l sync.Mutex</div><div class="line"><span class="keyword">var</span> a <span class="keyword">string</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">()</span></span> &#123;</div><div class="line">	a = <span class="string">"hello, world"</span></div><div class="line">	l.Unlock()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	l.Lock()</div><div class="line">	<span class="keyword">go</span> f()</div><div class="line">	l.Lock()</div><div class="line">	<span class="built_in">print</span>(a)</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p>两个lock之间必须有一个unlock,否则会在lock处无限等待</p><p>读写锁: 读-读能共存，读-写不能共存，写-写不能共存</p><p>这段是什么意思?</p><blockquote><p>For any call to l.RLock on a sync.RWMutex variable l, there is an n such that the l.RLock happens (returns) after call n to l.Unlock and the matching l.RUnlock happens before call n+1 to l.Lock.</p></blockquote><h2 id="Once"><a href="#Once" class="headerlink" title="Once"></a>Once</h2><p>once.Do(f)<br>是个在多线程中初始化的方法,所有调用once.Do的线程都会等待f完成,而且f只会运行一遍</p><p>例子:<br></p><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a <span class="keyword">string</span></div><div class="line"><span class="keyword">var</span> once sync.Once</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">()</span></span> &#123;</div><div class="line">	a = <span class="string">"hello, world"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">doprint</span><span class="params">()</span></span> &#123;</div><div class="line">	once.Do(setup)</div><div class="line">	<span class="built_in">print</span>(a)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">twoprint</span><span class="params">()</span></span> &#123;</div><div class="line">	<span class="keyword">go</span> doprint()</div><div class="line">	<span class="keyword">go</span> doprint()</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><h2 id="Incorrect-synchronization"><a href="#Incorrect-synchronization" class="headerlink" title="Incorrect synchronization"></a>Incorrect synchronization</h2><p>实在没看懂什么意思</p><blockquote><p>Note that a read r may observe the value written by a write w that happens concurrently with r. Even if this occurs, it does not imply that reads happening after r will observe writes that happened before w.</p></blockquote><p>第一个例子显然有问题</p><p>第二个输出结果竟然正确,我试了半天也没出错误结果</p><p>第三个结果也正确,但是我觉得问题是浪费了大量cpu资源</p><p>第四个例子不是同理么</p><p>我觉得根本原因是这句</p><blockquote><p>there is no guarantee that it will observe the initialized value for g.msg.</p></blockquote><p>不能保证!<br>很有可能编译器为了优化而让指令乱序执行</p><p><strong>所以,乖乖使用显式的同步语句吧</strong></p><p>有问题没关系,迟早能弄懂的</p><!-- rebuild by neat --></div></article></li><li class="reveal-detect"><article><div class="article-head"><h2 class="article-title"><a href="/2015/12/16/hello-world/">Hello World</a></h2><div class="meta article-date">2015-12-16</div></div><!-- abstract--><div class="article-content markdown-body"><!-- build time:Sat Jun 24 2017 17:11:19 GMT+0800 (CST) --><p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure><p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure><p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure><p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure><p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p><!-- rebuild by neat --></div></article></li></ul></section><footer id="page-footer"><nav id="footer-menu"><ul><li><a href="/about">About</a></li><li><a href="/archives">Archive</a></li><li><a href="https://github.com/fulvaz/hexo-theme">Source</a></li></ul></nav></footer></div><script src="/script/futil.min.js"></script><script src="/script/app_0.1.min.js"></script></body></html>